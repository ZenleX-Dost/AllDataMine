<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>app.py - Interactive Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-400 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 3000px; /* Increased for potentially longer content */
        }
        .code-block {
            background-color: #f3f4f6; /* gray-100 */
            border: 1px solid #e5e7eb; /* gray-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #1f2937; /* gray-800 */
            white-space: pre;
        }
        .sidebar-link.active {
            background-color: #e0f2fe; /* sky-100 */
            color: #0369a1; /* sky-700 */
            font-weight: 600;
        }
        .prose h4 { /* More specific prose styling if needed */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #0369a1; /* sky-700 */
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-stone-100 text-stone-800">
    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="w-full md:w-80 bg-stone-50 text-stone-700 p-6 shadow-lg md:min-h-screen print:hidden">
            <h1 class="text-2xl font-bold text-sky-700 mb-6 border-b-2 border-sky-200 pb-2">app.py (Streamlit) Docs</h1>
            <nav>
                <ul class="space-y-2">
                    <li><a href="#" class="sidebar-link block py-2 px-3 rounded-lg hover:bg-sky-50 transition-colors duration-200" data-target="overview">1. Overview & Purpose</a></li>
                    <li><a href="#" class="sidebar-link block py-2 px-3 rounded-lg hover:bg-sky-50 transition-colors duration-200" data-target="ui-structure">2. UI Structure</a></li>
                    <li><a href="#" class="sidebar-link block py-2 px-3 rounded-lg hover:bg-sky-50 transition-colors duration-200" data-target="core-functionality">3. Core Functionality</a></li>
                    <li><a href="#" class="sidebar-link block py-2 px-3 rounded-lg hover:bg-sky-50 transition-colors duration-200" data-target="how-to-run">4. How to Run & Use</a></li>
                    <li><a href="#" class="sidebar-link block py-2 px-3 rounded-lg hover:bg-sky-50 transition-colors duration-200" data-target="errors">5. Common Issues & Troubleshooting</a></li>
                </ul>
            </nav>
            <div class="mt-8 pt-4 border-t border-stone-300 text-xs text-stone-500">
                <p>GIIADS - StackUnderFlow</p>
            </div>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            <section id="overview" class="content-section active bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-semibold text-sky-600 mb-6">1. Overview & Purpose</h2>
                <div class="prose max-w-none text-stone-700">
                    <p>The <code>app.py</code> script is a Streamlit web application designed for predicting the Remaining Useful Life (RUL) of NASA turbofan engines using the C-MAPSS dataset. It provides an interactive interface for users to select datasets, configure model training parameters, trigger model training, and visualize results including data overviews, exploratory data analysis (EDA) plots, model performance metrics, and feature importances.</p>
                    <p>The application encapsulates a complete machine learning pipeline: data loading, preprocessing, feature engineering, model training (with cross-validation), and results interpretation. It aims to make the RUL prediction process accessible and explorable through a user-friendly web interface.</p>
                     <p class="mt-4 text-sm text-stone-600">This documentation will guide you through the application's UI, its core Python functions, how to run it, and common troubleshooting tips. Use the sidebar to navigate sections.</p>
                </div>
            </section>

            <section id="ui-structure" class="content-section bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-semibold text-sky-600 mb-6">2. UI Structure</h2>
                <p class="mb-6 text-stone-600">The application's user interface is built with Streamlit and organized into a sidebar for controls and a main area with tabs for displaying information. Click on each UI group to see details.</p>
                <div id="uiAccordionContainer" class="space-y-3">
                    </div>
            </section>

            <section id="core-functionality" class="content-section bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-semibold text-sky-600 mb-6">3. Core Functionality (Python Functions)</h2>
                <p class="mb-6 text-stone-600">The application's backend logic is driven by several key Python functions. Click on each function to see its description and code snippet.</p>
                <div id="functionsAccordionContainer" class="space-y-3">
                    </div>
            </section>

            <section id="how-to-run" class="content-section bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-semibold text-sky-600 mb-6">4. How to Run & Use</h2>
                <div class="prose max-w-none text-stone-700">
                    <h4>Prerequisites:</h4>
                    <ul class="list-disc list-inside ml-4">
                        <li>Python 3.x installed.</li>
                        <li>Required libraries installed (streamlit, pandas, numpy, scikit-learn, plotly, xgboost, stqdm). You can typically install these using pip:
                            <pre class="code-block"><code>pip install streamlit pandas numpy scikit-learn plotly xgboost stqdm</code></pre>
                        </li>
                        <li>The C-MAPSS dataset files (<code>train_FD00X.txt</code>, <code>test_FD00X.txt</code>, <code>RUL_FD00X.txt</code>) must be present in the same directory as <code>app.py</code>, or the paths in <code>load_data</code> function must be adjusted.</li>
                    </ul>

                    <h4>Running the Application:</h4>
                    <ol class="list-decimal list-inside ml-4">
                        <li>Open your terminal or command prompt.</li>
                        <li>Navigate to the directory where <code>app.py</code> is saved.</li>
                        <li>Run the command:
                            <pre class="code-block"><code>streamlit run app.py</code></pre>
                        </li>
                        <li>Streamlit will typically open the application automatically in your default web browser. If not, it will display a local URL (e.g., <code>http://localhost:8501</code>) that you can open.</li>
                    </ol>

                    <h4>Using the Application:</h4>
                    <ol class="list-decimal list-inside ml-4">
                        <li><strong>Select Dataset:</strong> Use the "Select Dataset" dropdown in the sidebar to choose one of the FD001, FD002, FD003, or FD004 datasets.</li>
                        <li><strong>Configure Training Settings:</strong> Expand the "Training Settings" section in the sidebar to:
                            <ul class="list-disc list-inside ml-6">
                                <li>Toggle options like "Subsample FD002/FD004", "Quick Mode", "Use Top 5 Sensors Only".</li>
                                <li>Adjust "Number of Estimators" and "Max Depth" for the Random Forest model.</li>
                            </ul>
                        </li>
                        <li><strong>Train Models:</strong> Click the "Train Models" button in the sidebar. A spinner will indicate that training is in progress. This may take some time depending on the dataset and settings.</li>
                        <li><strong>Explore Tabs:</strong> Once training is complete (or data is loaded), navigate through the tabs in the main area:
                            <ul class="list-disc list-inside ml-6">
                                <li><strong>Data Overview:</strong> View basic information about the loaded train and test data.</li>
                                <li><strong>EDA:</strong> Explore sensor trends and correlations.</li>
                                <li><strong>Model Training:</strong> This tab primarily shows the training status. Results appear in the "Results" tab.</li>
                                <li><strong>Results:</strong> View detailed model performance metrics (CV and Test), feature importances, and a plot of predicted vs. true RUL.</li>
                                <li><strong>Cross-Dataset Summary:</strong> If you train models for multiple datasets during a session, this tab compares their performance.</li>
                                <li><strong>Decision:</strong> Provides a recommendation for the best model and settings based on the trained models in the current session and allows downloading a summary.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            </section>

            <section id="errors" class="content-section bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-3xl font-semibold text-sky-600 mb-6">5. Common Issues & Troubleshooting</h2>
                <div class="prose max-w-none text-stone-700 space-y-4">
                    <div>
                        <h4 class="font-semibold text-lg text-sky-700">1. FileNotFoundError for Dataset Files</h4>
                        <p><strong>Symptom:</strong> Application shows an error like "File train_FD001.txt not found" when selecting a dataset or on startup.</p>
                        <p><strong>Cause:</strong> The C-MAPSS dataset files are not in the same directory as <code>app.py</code>.</p>
                        <p><strong>Solution:</strong> Ensure all <code>train_FD00X.txt</code>, <code>test_FD00X.txt</code>, and <code>RUL_FD00X.txt</code> files are in the same folder as <code>app.py</code>.</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-sky-700">2. ModuleNotFoundError for Libraries</h4>
                        <p><strong>Symptom:</strong> Streamlit fails to start, showing an error like <code>ModuleNotFoundError: No module named 'streamlit'</code> (or pandas, sklearn, etc.).</p>
                        <p><strong>Cause:</strong> Required Python libraries are not installed in the environment Streamlit is using.</p>
                        <p><strong>Solution:</strong> Install missing libraries using pip: <code>pip install streamlit pandas numpy scikit-learn plotly xgboost stqdm</code>. Ensure you are installing them in the correct Python environment if you use virtual environments.</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-sky-700">3. Slow Performance or App Crash During Training</h4>
                        <p><strong>Symptom:</strong> The app becomes unresponsive or crashes, especially when training on larger datasets (FD002, FD004) with many estimators or full features.</p>
                        <p><strong>Cause:</strong> Model training, especially Random Forest with many trees or XGBoost, can be memory and CPU intensive.</p>
                        <p><strong>Solutions:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Use the "Subsample FD002/FD004" option.</li>
                            <li>Enable "Quick Mode (Random Forest Only)".</li>
                            <li>Enable "Use Top 5 Sensors Only".</li>
                            <li>Reduce the "Number of Estimators" or set a "Max Depth" for the Random Forest.</li>
                            <li>Ensure your machine has sufficient RAM.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-sky-700">4. Plots Not Displaying Correctly or Errors in Tabs</h4>
                        <p><strong>Symptom:</strong> Specific tabs (e.g., Results, EDA) show errors or plots are missing after training.</p>
                        <p><strong>Cause:</strong> Could be an issue with data processing for that specific plot (e.g., all NaN data for a sensor), an error during model training that wasn't caught, or an issue with how results are stored/retrieved from <code>st.session_state</code>.</p>
                        <p><strong>Solutions:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Check the terminal where you ran <code>streamlit run app.py</code> for any Python error messages. These often provide more detail.</li>
                            <li>Try with a simpler dataset (FD001) and default settings to see if the issue is specific to certain configurations.</li>
                            <li>Examine the data preprocessing and feature engineering steps to ensure they handle edge cases (e.g., constant sensor values leading to zero standard deviation).</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-sky-700">5. KMeans `n_init` Warning or Issues</h4>
                         <p><strong>Symptom:</strong> A warning related to `n_init` in KMeans or unexpected clustering results.</p>
                         <p><strong>Cause:</strong> Default value of `n_init` in `KMeans` might change in future scikit-learn versions. The script uses `random_state=42` but doesn't explicitly set `n_init` in `app.py`.</p>
                         <p><strong>Solution:</strong> For consistency and to suppress potential warnings, explicitly set `n_init` in the `KMeans` call within `preprocess_data`: `kmeans = KMeans(n_clusters=6, random_state=42, n_init=10)` (or `n_init='auto'` if preferred and supported by your sklearn version).</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const uiAccordionData = [
            {
                id: 'sidebar-controls',
                title: 'Sidebar Controls',
                descriptionHTML: `<p>The sidebar provides the main controls for the application.</p>
                                  <ul class="list-disc list-inside ml-4 space-y-1">
                                    <li><strong>NASA Image & Title:</strong> Branding for the application.</li>
                                    <li><strong>Dataset Selection (st.selectbox):</strong> Allows choosing between FD001, FD002, FD003, FD004 datasets. Changing this reloads data.</li>
                                    <li><strong>Training Settings (st.expander):</strong>
                                        <ul class="list-disc list-inside ml-6">
                                            <li><strong>Subsample FD002/FD004 (st.checkbox):</strong> If checked, uses 70% of engines for FD002/FD004 training (faster).</li>
                                            <li><strong>Quick Mode (st.checkbox):</strong> If checked, only trains Random Forest, skipping Linear Regression and XGBoost (faster).</li>
                                            <li><strong>Use Top 5 Sensors Only (st.checkbox):</strong> If checked, feature engineering uses only the 5 sensors most correlated with RUL.</li>
                                            <li><strong>Number of Estimators (st.slider):</strong> Sets <code>n_estimators</code> for Random Forest (20-100).</li>
                                            <li><strong>Max Depth (st.selectbox):</strong> Sets <code>max_depth</code> for Random Forest ('None', 10, 20).</li>
                                        </ul>
                                    </li>
                                    <li><strong>Train Models (st.button):</strong> Clicking this initiates data preprocessing, feature engineering, and model training based on selected settings.</li>
                                  </ul>`
            },
            {
                id: 'main-tabs',
                title: 'Main Area Tabs (st.tabs)',
                descriptionHTML: `<p>The main content area uses tabs to organize different views of the data and results.</p>
                                  <ul class="list-disc list-inside ml-4 space-y-1">
                                    <li><strong>Data Overview:</strong> Displays head of train/test data, shapes, and sum of missing values.</li>
                                    <li><strong>EDA:</strong> Shows sensor trend plots for Engine 1, top sensors correlated with RUL, and operating condition distribution (for FD002/FD004).</li>
                                    <li><strong>Model Training:</strong> Indicates training status. Primary results are shown in the 'Results' tab.</li>
                                    <li><strong>Results:</strong> Presents cross-validation scores, test set metrics (RMSE, MAE, R2, Custom Score), top 10 important features from Random Forest, and a scatter plot of Predicted vs. True RUL.</li>
                                    <li><strong>Cross-Dataset Summary:</strong> If models are trained for multiple datasets in the same session, this tab shows a comparative table of their performance metrics.</li>
                                    <li><strong>Decision:</strong> Provides a model recommendation based on performance across trained datasets and allows downloading a CSV summary of the decision.</li>
                                  </ul>`
            }
        ];

        const functionsAccordionData = [
            {
                id: 'custom-score',
                title: 'custom_score(y_true, y_pred)',
                descriptionHTML: `<p><strong>Purpose:</strong> Calculates the asymmetric scoring function used in the PHM08 challenge. It penalizes late predictions more heavily than early predictions.</p>
                                  <p><strong>Parameters:</strong></p>
                                  <ul class="list-disc list-inside ml-4"><li><code>y_true</code>: Array of true RUL values.</li><li><code>y_pred</code>: Array of predicted RUL values.</li></ul>
                                  <p><strong>Returns:</strong> The sum of scores for all predictions.</p>`,
                codeSnippet: `def custom_score(y_true, y_pred):\n    d = y_pred - y_true\n    return np.sum(np.where(d < 0, np.exp(-d / 10) - 1, np.exp(d / 13) - 1))`
            },
            {
                id: 'load-data',
                title: 'load_data(dataset)',
                decorator: '@st.cache_data',
                descriptionHTML: `<p><strong>Purpose:</strong> Loads the training data, test data, and true RUL values for the specified dataset from text files. Uses Streamlit's caching to speed up subsequent loads of the same dataset.</p>
                                  <p><strong>Parameters:</strong></p>
                                  <ul class="list-disc list-inside ml-4"><li><code>dataset</code> (str): The dataset identifier (e.g., 'FD001').</li></ul>
                                  <p><strong>Returns:</strong> A tuple <code>(train_data, test_data, true_rul, error_message)</code>. <code>error_message</code> is non-None if a file is not found.</p>`,
                codeSnippet: `columns = ['unit_number', 'time_cycles'] + \\\n              [f'setting_{i}' for i in range(1, 4)] + \\\n              [f'sensor_{i}' for i in range(1, 22)]\n\n@st.cache_data\ndef load_data(dataset):\n    # ... (file existence check) ...\n    train_data = pd.read_csv(f'train_{dataset}.txt', sep='\\s+', header=None, names=columns)\n    test_data = pd.read_csv(f'test_{dataset}.txt', sep='\\s+', header=None, names=columns)\n    true_rul = pd.read_csv(f'RUL_{dataset}.txt', header=None, names=['true_rul'])\n    return train_data, test_data, true_rul, None`
            },
            {
                id: 'preprocess-data',
                title: 'preprocess_data(train_data, test_data, dataset)',
                decorator: '@st.cache_data',
                descriptionHTML: `<p><strong>Purpose:</strong> Preprocesses the loaded training and test data. This includes calculating RUL for training data, scaling features using MinMaxScaler, and identifying operating conditions using KMeans for relevant datasets (FD002, FD004).</p>
                                  <p><strong>Parameters:</strong></p>
                                  <ul class="list-disc list-inside ml-4"><li><code>train_data</code> (DataFrame): Raw training data.</li><li><code>test_data</code> (DataFrame): Raw test data.</li><li><code>dataset</code> (str): Dataset identifier.</li></ul>
                                  <p><strong>Returns:</strong> A tuple <code>(processed_train_data, processed_test_data)</code>.</p>`,
                codeSnippet: `@st.cache_data\ndef preprocess_data(train_data, test_data, dataset):\n    train_data['max_cycle'] = train_data.groupby('unit_number')['time_cycles'].transform('max')\n    train_data['RUL'] = train_data['max_cycle'] - train_data['time_cycles']\n    \n    scale_cols = [f'setting_{i}' for i in range(1, 4)] + [f'sensor_{i}' for i in range(1, 22)]\n    scaler = MinMaxScaler()\n    train_data[scale_cols] = scaler.fit_transform(train_data[scale_cols])\n    test_data[scale_cols] = scaler.transform(test_data[scale_cols])\n    \n    if dataset in ['FD002', 'FD004']:\n        setting_cols = [f'setting_{i}' for i in range(1, 4)]\n        kmeans = KMeans(n_clusters=6, random_state=42, n_init=10) # Added n_init for robustness\n        train_data['op_condition'] = kmeans.fit_predict(train_data[setting_cols])\n        test_data['op_condition'] = kmeans.predict(test_data[setting_cols])\n    else:\n        train_data['op_condition'] = 0\n        test_data['op_condition'] = 0\n    return train_data, test_data`
            },
            {
                id: 'engineer-features',
                title: 'engineer_features(train_data, test_data, dataset, use_top_features)',
                decorator: '@st.cache_data',
                descriptionHTML: `<p><strong>Purpose:</strong> Creates new features from sensor data, including rolling means, rolling standard deviations, and lagged features. Optionally uses only top correlated sensors.</p>
                                  <p><strong>Parameters:</strong></p>
                                  <ul class="list-disc list-inside ml-4"><li><code>train_data</code>, <code>test_data</code>: Preprocessed data.</li><li><code>dataset</code>: Dataset identifier.</li><li><code>use_top_features</code> (bool): Whether to use only top 5 sensors.</li></ul>
                                  <p><strong>Returns:</strong> Tuple <code>(train_data_eng, test_data_eng, feature_cols_list)</code>.</p>`,
                codeSnippet: `@st.cache_data\ndef engineer_features(train_data, test_data, dataset, use_top_features):\n    window = 5\n    sensors_to_use = [f'sensor_{i}' for i in range(1, 22)]\n    if use_top_features:\n        # ... (logic to select top 5 sensors based on correlation with RUL) ...\n        # This part requires RUL in train_data, ensure it's present before this call if use_top_features is True\n        correlations = train_data[[f'sensor_{i}' for i in range(1, 22)] + ['RUL']].corr()\n        top_sensors_names = correlations['RUL'].abs().sort_values(ascending=False).head(5).index.tolist()\n        sensors_to_use = [s for s in sensors_to_use if s in top_sensors_names]\n\n    for sensor in sensors_to_use:\n        # ... (rolling mean, std, lag1, lag2 feature creation) ...\n    # ... (define final feature_cols list) ...\n    return train_data, test_data, feature_cols`
            },
            {
                id: 'train-models',
                title: 'train_models(train_data, test_data, true_rul, feature_cols, dataset, subsample, quick_mode, n_estimators, max_depth)',
                decorator: '@st.cache_resource',
                descriptionHTML: `<p><strong>Purpose:</strong> Trains machine learning models (Random Forest, optionally Linear Regression and XGBoost) using cross-validation. Evaluates on the test set and returns results including metrics, feature importances, and plots.</p>
                                  <p><strong>Parameters:</strong> Numerous, including data, feature list, dataset ID, and training configuration options from the sidebar.</p>
                                  <p><strong>Returns:</strong> A dictionary containing CV results, Test results, Feature Importance DataFrame, Predictions tuple, and a Plotly figure for RUL comparison.</p>`,
                codeSnippet: `@st.cache_resource\ndef train_models(...):\n    results = {}\n    # ... (Optional subsampling for FD002/FD004) ...\n    kf = KFold(n_splits=3, shuffle=True, random_state=42)\n    models = {'Random Forest': RandomForestRegressor(...)}\n    if not quick_mode:\n        models.update({'Linear Regression': LinearRegression(), 'XGBoost': xgb.XGBRegressor(...)})\n    \n    # ... (Cross-validation loop for each model using stqdm for progress bar) ...\n    # ... (Train final Random Forest on full training data) ...\n    # ... (Predict on test set's last cycles) ...\n    # ... (Calculate test metrics) ...\n    # ... (Get feature importances) ...\n    # ... (Create Plotly scatter plot of predicted vs true RUL) ...\n    return results_dict # Structure containing all metrics and plots`
            }
        ];

        function populateAccordion(containerId, dataArray) {
            const container = document.getElementById(containerId);
            if (!container) return;

            dataArray.forEach(item => {
                const accordionItem = document.createElement('div');
                accordionItem.classList.add('border', 'border-stone-200', 'rounded-lg', 'overflow-hidden', 'shadow-sm');

                const button = document.createElement('button');
                button.classList.add('w-full', 'p-4', 'text-left', 'bg-stone-50', 'hover:bg-sky-50', 'focus:outline-none', 'transition-colors', 'duration-200', 'flex', 'justify-between', 'items-center');
                let titleHTML = `<span class="font-semibold text-sky-700">${item.title}</span>`;
                if (item.decorator) {
                    titleHTML = `<div class="flex flex-col"><span class="font-semibold text-sky-700">${item.title}</span><span class="text-xs text-sky-500">${item.decorator}</span></div>`;
                }
                button.innerHTML = `
                    ${titleHTML}
                    <svg class="w-5 h-5 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                `;

                const content = document.createElement('div');
                content.classList.add('accordion-content', 'p-4', 'border-t', 'border-stone-200', 'bg-white');
                
                let codeBlockHTML = '';
                if (item.codeSnippet) {
                    const escapedCode = item.codeSnippet.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    codeBlockHTML = `<h4 class="font-semibold text-stone-700 mt-3 mb-1">Code Snippet (Conceptual):</h4><pre class="code-block"><code>${escapedCode}</code></pre>`;
                }

                content.innerHTML = `
                    <div class="prose prose-sm max-w-none text-stone-600">
                        ${item.descriptionHTML}
                        ${codeBlockHTML}
                    </div>
                `;

                button.addEventListener('click', () => {
                    const svg = button.querySelector('svg');
                    content.classList.toggle('open');
                    svg.classList.toggle('rotate-180');
                });

                accordionItem.appendChild(button);
                accordionItem.appendChild(content);
                container.appendChild(accordionItem);
            });
        }
        
        populateAccordion('uiAccordionContainer', uiAccordionData);
        populateAccordion('functionsAccordionContainer', functionsAccordionData);

        const contentSections = document.querySelectorAll('.content-section');
        const sidebarLinks = document.querySelectorAll('.sidebar-link');

        sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('data-target');

                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(targetId).classList.add('active');

                sidebarLinks.forEach(s_link => s_link.classList.remove('active'));
                link.classList.add('active');
                
                if (window.innerWidth < 768) {
                    document.querySelector('main').scrollTop = 0;
                }
            });
        });

        if (sidebarLinks.length > 0) {
            sidebarLinks[0].classList.add('active');
        }
        
        document.getElementById('generationDate').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric', month: 'long', day: 'numeric'
        });

    </script>
</body>
</html>
